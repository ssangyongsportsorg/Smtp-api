# 變更日誌

## 版本 2.0.0 - 2024-01-01

### 🚀 新功能

#### 安全性增強
- ✅ 添加 JWT 身份驗證系統
- ✅ 實現 API key 驗證機制
- ✅ 添加速率限制防護
- ✅ 實現 Helmet.js 安全標頭
- ✅ 添加輸入驗證和清理
- ✅ 實現密碼加密存儲
- ✅ 添加會話安全配置

#### 管理功能
- ✅ 實現首次部署自動註冊功能
- ✅ 添加管理員註冊/登入系統
- ✅ 實現密碼強度驗證
- ✅ 添加管理員帳號管理

#### API Key 管理
- ✅ 實現安全的 API key 生成
- ✅ 添加 API key 使用限制 (總次數、每小時、每日、每月)
- ✅ 實現 API key 過期時間設定
- ✅ 添加 API key 狀態管理

#### 郵件功能增強
- ✅ 實現多層級速率限制 (每小時/每日/每月)
- ✅ 添加郵件格式驗證
- ✅ 實現詳細的郵件發送記錄
- ✅ 添加郵件發送狀態追蹤

#### 監控功能
- ✅ 實現系統狀態監控頁面
- ✅ 添加資料庫連接狀態檢查
- ✅ 實現管理員設定狀態檢查
- ✅ 添加系統運行時間監控
- ✅ 實現即時狀態更新

#### 用戶介面
- ✅ 重新設計首頁為系統狀態頁面
- ✅ 實現現代化的管理後台
- ✅ 添加響應式設計
- ✅ 實現 Tab 式導航
- ✅ 添加即時數據更新

### 🔧 技術改進

#### 後端架構
- ✅ 重構伺服器架構
- ✅ 添加中間件層
- ✅ 實現錯誤處理機制
- ✅ 添加日誌記錄
- ✅ 實現資料庫連接池

#### 資料庫結構
- ✅ 更新 Prisma schema
- ✅ 添加 API key 限制欄位
- ✅ 實現關聯查詢優化
- ✅ 添加索引優化

#### 安全性
- ✅ 實現 CORS 配置
- ✅ 添加 Content Security Policy
- ✅ 實現 XSS 防護
- ✅ 添加 CSRF 防護
- ✅ 實現 SQL 注入防護

### 📚 文檔和工具

#### 文檔
- ✅ 更新 README.md
- ✅ 創建詳細的 API 文檔
- ✅ 添加安全檢查清單
- ✅ 創建部署指南
- ✅ 添加使用範例

#### 部署工具
- ✅ 創建自動部署腳本
- ✅ 添加環境變數範例
- ✅ 創建 Docker 配置
- ✅ 添加啟動腳本

### 🐛 修復

- ✅ 修復 SMTP 配置驗證問題
- ✅ 修復郵件發送錯誤處理
- ✅ 修復資料庫連接問題
- ✅ 修復前端顯示問題

### 🔄 變更

#### 破壞性變更
- ❌ 移除了舊的管理介面
- ❌ 更改了 API 端點結構
- ❌ 更新了認證機制

#### 向後兼容
- ✅ 保持基本的 SMTP 功能
- ✅ 保持郵件發送 API 結構
- ✅ 保持資料庫基本結構

### 📦 依賴更新

#### 新增依賴
- `express-rate-limit`: 速率限制
- `helmet`: 安全標頭
- `bcryptjs`: 密碼加密
- `jsonwebtoken`: JWT 認證
- `express-session`: 會話管理

#### 更新依賴
- `express`: 更新到最新版本
- `prisma`: 更新到最新版本
- `nodemailer`: 更新到最新版本

### 🚀 部署說明

#### 新安裝
1. 運行 `./deploy.sh` 自動部署腳本
2. 配置 `.env` 文件
3. 訪問 `/admin` 註冊第一個管理員
4. 配置 SMTP 和 API key

#### 升級現有系統
1. 備份現有資料
2. 更新代碼
3. 運行資料庫遷移
4. 更新環境變數
5. 重新啟動服務

### 🔐 安全建議

#### 生產環境
- 更改所有預設密鑰
- 使用 HTTPS
- 設定防火牆規則
- 定期備份資料
- 監控系統日誌

#### 定期維護
- 更新依賴套件
- 檢查安全漏洞
- 審查存取日誌
- 測試備份恢復

### 📞 支援

如有問題或建議，請：
1. 查看文檔
2. 檢查安全清單
3. 開立 Issue
4. 聯絡開發團隊

---

## 版本 1.0.0 - 2023-12-01

### 初始版本功能
- 基本的 SMTP 輪播功能
- 簡單的管理介面
- 郵件發送 API
- 基本的使用量追蹤